
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Slot Filling &#8212; Rasa Core 0.10.0a2 documentation</title>
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/banner.css" type="text/css" />
    <link rel="stylesheet" href="../_static/button.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../genindex/" />
    <link rel="search" title="Search" href="../search/" />
    <link rel="next" title="Interactive Learning" href="../interactive_learning/" />
    <link rel="prev" title="Using Slots" href="../slots/" />
   
  <!--<link rel="stylesheet" href="../_static/custom.css" type="text/css" />-->
  <link rel="stylesheet" href="../_static/xq-light.css" type="text/css" />
  <link rel="stylesheet" href="../_static/fontawesome/css/fontawesome-all.css" type="text/css" />
  <script defer type="text/javascript" src="../_static/config.js"></script>
  <script defer type="text/javascript" src="../_static/klaro.js"></script>
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>

<div class="nav-top">
  <h1 class="brand">
    <a href="/">
      <img src="/_static/rasa_logo.svg" width="80px" height="40px" title="Rasa" alt="Rasa logo">
    </a>
  </h1>
  <span class="logo extension">docs</span>
  
  <ul class="nav">
    
      
        <li><a href=https://newdocs.rasa.com/about>About</a></li>
      
    
      
        <li><a href=https://newdocs.rasa.com/nlu>NLU</a></li>
      
    
      
        <li class="active"><a href=https://newdocs.rasa.com/core>Core</a></li>
      
    
      
        <li><a href=https://newdocs.rasa.com/platform>Platform</a></li>
      
    
    
    <li>
      <a href="https://www.github.com/RasaHQ" target="_blank"><button class="button btn-ghost btn-small"><i class="fab fa-github"></i>GitHub</button></a>
    </li>
    
  </ul>
</div>


  <div class="document">
    
    
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><p class="caption"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../quickstart/">Quickstart</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation/">Installation</a></li>
</ul>
<p class="caption"><span class="caption-text">User Guide</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../architecture/">High-Level Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../connectors/">Chat &amp; Voice platforms</a></li>
<li class="toctree-l1"><a class="reference internal" href="../customactions/">Custom Actions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../slots/">Using Slots</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Slot Filling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../interactive_learning/">Interactive Learning</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fallbacks/">Fallback / Default Actions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../policies/">Training and Policies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../debugging/">Debugging</a></li>
<li class="toctree-l1"><a class="reference internal" href="../evaluation/">Evaluating and Testing</a></li>
</ul>
<p class="caption"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../domains/">Domain Format</a></li>
<li class="toctree-l1"><a class="reference internal" href="../stories/">Story Data Format</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/slots_api/">Slot Types</a></li>
<li class="toctree-l1"><a class="reference internal" href="../server/">Server Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../http/">HTTP API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/agent/">Agent</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/events/">Events</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/tracker/">Dialogue State Tracker</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/interpreter/">Interpreters</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/policy/">Policy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/featurizer/">Featurization</a></li>
</ul>
<p class="caption"><span class="caption-text">Developer Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../migrations/">Migration Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../changelog/">Change Log</a></li>
</ul>

<div class="versions">
    <div>
      <span class="current-version">
        v: docs_reorg
      </span>
    </div>
    <div class="other-versions">
        <div class="dropdown">
          <button class="dropdown-btn">tags</button>
          <div class="dropdown-content">
              <a href="../0.9.6/index.html">0.9.6</a>
              <a href="../0.9.5/index.html">0.9.5</a>
              <a href="../0.9.4/index.html">0.9.4</a>
              <a href="../0.9.3/index.html">0.9.3</a>
              <a href="../0.9.2/index.html">0.9.2</a>
              <a href="../0.9.1/index.html">0.9.1</a>
              <a href="../0.9.0/index.html">0.9.0</a>
              <a href="../0.8.6/index.html">0.8.6</a>
              <a href="../0.7.9/index.html">0.7.9</a>
              <a href="../0.6.9/index.html">0.6.9</a>
          </div>
        </div>
        <div class="dropdown">
          <button class="dropdown-btn">tags</button>
          <div class="dropdown-content">
              <a href="slotfilling.html">docs_reorg</a>
              <a href="../master/index.html">master</a>
          </div>
        </div>
    </div>
</div>


        </div>
      </div>
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  


    
    



    <p class="scv-banner"><b>Warning:</b> This document is for the development version of Rasa Core.</p>
<div class="section" id="slot-filling">
<span id="slotfilling"></span><h1>Slot Filling<a class="headerlink" href="#slot-filling" title="Permalink to this headline">¬∂</a></h1>
<p>One of the most common conversation patterns
is to collect a few pieces of information
from a user in order to do something (book a restaurant, call an API, search a database, etc.).
This is also called <strong>slot filling</strong>.</p>
<div class="section" id="example-providing-the-weather">
<h2>Example: Providing the Weather<a class="headerlink" href="#example-providing-the-weather" title="Permalink to this headline">¬∂</a></h2>
<p>Let‚Äôs say you are building a weather bot ‚õÖÔ∏è. If somebody asks you for the weather, you will
need to know their location. Users might say that right away, e.g. <cite>What‚Äôs the weather in Caracas?</cite>
When they don‚Äôt provide this information, you‚Äôll have to ask them for it.
We can provide two stories to Rasa Core, so that it can learn to handle both cases:</p>
<div class="highlight-md notranslate"><div class="highlight"><pre><span></span><span class="gh">#</span> story1
<span class="k">*</span> ask_weather{&quot;location&quot;: &quot;Caracas&quot;}
   <span class="k">-</span> action_weather_api

<span class="gh">#</span> story2
<span class="k">*</span> ask_weather
   <span class="k">-</span> utter_ask_location
<span class="k">*</span> inform{&quot;location&quot;: &quot;Caracas&quot;}
   <span class="k">-</span> action_weather_api
</pre></div>
</div>
<p>Here we are assuming you have defined an <code class="docutils literal notranslate"><span class="pre">inform</span></code> intent, which captures the cases where a user
is just providing information.</p>
<p>But <a class="reference internal" href="../customactions/#customactions"><span class="std std-ref">Custom Actions</span></a> can also set slots, and these can also influence the conversation.
For example, a location like <cite>San Jose</cite> could refer to multiple places, in this case, probably in
Costa Rica üá®üá∑  or California üá∫üá∏</p>
<p>Let‚Äôs add a call to a location API to deal with this.
Start by defining a <code class="docutils literal notranslate"><span class="pre">location_match</span></code> slot:</p>
<div class="highlight-md notranslate"><div class="highlight"><pre><span></span>slots:
  location_match:
    type: categorical
    values:
    <span class="k">-</span> zero
    <span class="k">-</span> one
    <span class="k">-</span> multiple
</pre></div>
</div>
<p>And our location api action will have to use the API response to fill in this slot.
It can <code class="docutils literal notranslate"><span class="pre">return</span> <span class="pre">[SlotSet(&quot;location_match&quot;,</span> <span class="pre">value)]</span></code>, where <code class="docutils literal notranslate"><span class="pre">value</span></code> is one of <code class="docutils literal notranslate"><span class="pre">&quot;zero&quot;</span></code>, <code class="docutils literal notranslate"><span class="pre">&quot;one&quot;</span></code>, or
<code class="docutils literal notranslate"><span class="pre">&quot;multiple&quot;</span></code>, depending on what the API sends back.</p>
<p>We then define stories for each of these cases:</p>
<div class="highlight-md notranslate"><div class="highlight"><pre><span></span><span class="gh">#</span> story1
<span class="k">*</span> ask_weather{&quot;location&quot;: &quot;Caracas&quot;}
   <span class="k">-</span> action_location_api
   <span class="k">-</span> slot{&quot;location_match&quot;: &quot;one&quot;}
   <span class="k">-</span> action_weather_api

<span class="gh">#</span> story2
<span class="k">*</span> ask_weather
   <span class="k">-</span> utter_ask_location
<span class="k">*</span> inform{&quot;location&quot;: &quot;Caracas&quot;}
   <span class="k">-</span> action_location_api
<span class="hll">   <span class="k">-</span> slot{&quot;location_match&quot;: &quot;one&quot;}
</span><span class="hll">   <span class="k">-</span> action_weather_api
</span>
<span class="gh">#</span> story3
<span class="k">*</span> ask_weather{&quot;location&quot;: &quot;the Moon&quot;}
   <span class="k">-</span> action_location_api
<span class="hll">   <span class="k">-</span> slot{&quot;location_match&quot;: &quot;none&quot;}
</span><span class="hll">   <span class="k">-</span> utter_location_not_found
</span>
<span class="gh">#</span> story4
<span class="k">*</span> ask_weather{&quot;location&quot;: &quot;San Jose&quot;}
   <span class="k">-</span> action_location_api
<span class="hll">   <span class="k">-</span> slot{&quot;location_match&quot;: &quot;multiple&quot;}
</span><span class="hll">   <span class="k">-</span> utter_ask_which_location
</span></pre></div>
</div>
<p>Now we‚Äôve given Rasa Core a few examples of how to handle the different values
that the <code class="docutils literal notranslate"><span class="pre">location_match</span></code> slot can take. With so little data, your trained
policy will still get things wrong sometimes, because the dialogue history went
differently from exactly what‚Äôs in the training data. <a class="reference internal" href="../interactive_learning/#interactive-learning"><span class="std std-ref">Interactive Learning</span></a> is a
great way to explore more conversations that aren‚Äôt in your stories already.
The best way to improve your model is to test it yourself, have other people test it,
and correct the mistakes it makes.</p>
<div class="section" id="debugging">
<h3>Debugging<a class="headerlink" href="#debugging" title="Permalink to this headline">¬∂</a></h3>
<p>If something doesn‚Äôt work as you expect, <strong>don‚Äôt panic</strong>!
If you are just getting started,
you probably only have a few hand-written stories. This is a great starting point, but
you should give your bot to people to test <strong>as soon as possible</strong>. One of the guiding principles
behind Rasa Core is this:</p>
<blockquote class="pull-quote">
<div>Learning from real conversations is more important than designing hypothetical ones</div></blockquote>
<p>So don‚Äôt try to cover every possiblity in your hand-written stories before giving it to testers.
Real user behavior will always surprise you!</p>
</div>
</div>
<div class="section" id="slot-filling-with-a-formaction">
<h2>Slot Filling with a <code class="docutils literal notranslate"><span class="pre">FormAction</span></code><a class="headerlink" href="#slot-filling-with-a-formaction" title="Permalink to this headline">¬∂</a></h2>
<p>If you need to collect multiple pieces of information in a row, it is sometimes easier
to create a <code class="docutils literal notranslate"><span class="pre">FormAction</span></code>.
This lets you have a single action that is called multiple times, rather than separate actions for each question,
e.g. <code class="docutils literal notranslate"><span class="pre">utter_ask_cuisine</span></code>, <code class="docutils literal notranslate"><span class="pre">utter_ask_numpeople</span></code>, in a restaurant bot.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">You don‚Äôt <em>have</em> to use a <code class="docutils literal notranslate"><span class="pre">FormAction</span></code> to do slot filling! It just means you need
fewer stories to get the initial flow working.</p>
</div>
<p>A form action has a set of required fields, which you define for the class:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">ActionSearchRestaurants</span><span class="p">(</span><span class="n">FormAction</span><span class="p">):</span>

    <span class="n">RANDOMIZE</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">required_fields</span><span class="p">():</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="n">EntityFormField</span><span class="p">(</span><span class="s2">&quot;cuisine&quot;</span><span class="p">,</span> <span class="s2">&quot;cuisine&quot;</span><span class="p">),</span>
            <span class="n">EntityFormField</span><span class="p">(</span><span class="s2">&quot;number&quot;</span><span class="p">,</span> <span class="s2">&quot;people&quot;</span><span class="p">),</span>
            <span class="n">BooleanFormField</span><span class="p">(</span><span class="s2">&quot;vegetarian&quot;</span><span class="p">,</span> <span class="s2">&quot;affirm&quot;</span><span class="p">,</span> <span class="s2">&quot;deny&quot;</span><span class="p">)</span>
        <span class="p">]</span>

    <span class="k">def</span> <span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;action_search_restaurants&#39;</span>

    <span class="k">def</span> <span class="nf">submit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dispatcher</span><span class="p">,</span> <span class="n">tracker</span><span class="p">,</span> <span class="n">domain</span><span class="p">):</span>
        <span class="n">results</span> <span class="o">=</span> <span class="n">RestaurantAPI</span><span class="p">()</span><span class="o">.</span><span class="n">search</span><span class="p">(</span>
            <span class="n">tracker</span><span class="o">.</span><span class="n">get_slot</span><span class="p">(</span><span class="s2">&quot;cuisine&quot;</span><span class="p">),</span>
            <span class="n">tracker</span><span class="o">.</span><span class="n">get_slot</span><span class="p">(</span><span class="s2">&quot;people&quot;</span><span class="p">),</span>
            <span class="n">tracker</span><span class="o">.</span><span class="n">get_slot</span><span class="p">(</span><span class="s2">&quot;vegetarian&quot;</span><span class="p">))</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">SlotSet</span><span class="p">(</span><span class="s2">&quot;search_results&quot;</span><span class="p">,</span> <span class="n">results</span><span class="p">)]</span>
</pre></div>
</div>
<p>The way this works is that every time you call this action, it will pick one of the
<code class="docutils literal notranslate"><span class="pre">REQUIRED_FIELDS</span></code> that‚Äôs still missing and ask the user for it. You can also ask a yes/no
question with a <code class="docutils literal notranslate"><span class="pre">BooleanFormField</span></code>.</p>
<p>The story will look something like this:</p>
<div class="highlight-md notranslate"><div class="highlight"><pre><span></span><span class="k">*</span> request_restaurant
     <span class="k">-</span> action_restaurant_form
     <span class="k">-</span> slot{&quot;requested_slot&quot;: &quot;people&quot;}
<span class="k">*</span> inform{&quot;number&quot;: 3}
     <span class="k">-</span> action_restaurant_form
     <span class="k">-</span> slot{&quot;people&quot;: 3}
     <span class="k">-</span> slot{&quot;requested_slot&quot;: &quot;time&quot;}
<span class="k">*</span> inform{&quot;time&quot;: &quot;8pm&quot;}
   <span class="k">-</span> action_restaurant_form
</pre></div>
</div>
<p>Some important things to consider:</p>
<ul class="simple">
<li>The <code class="docutils literal notranslate"><span class="pre">submit()</span></code> method is called when the action is run and all slots are filled.
If you are just collecting some information and don‚Äôt need to make an API call at the end, your <code class="docutils literal notranslate"><span class="pre">submit()</span></code> method
should just <code class="docutils literal notranslate"><span class="pre">return</span> <span class="pre">[]</span></code>.</li>
<li>Your domain needs to have a slot called <code class="docutils literal notranslate"><span class="pre">requested_slot</span></code>. This can be unfeaturized, but if you want
to support contextual questions like <em>‚Äúwhy do you need to know that information?‚Äù</em> it will help if you make this
a categorical slot.</li>
<li>You need to define utterances for asking for each slot in your domain, e.g. <code class="docutils literal notranslate"><span class="pre">utter_ask_{slot_name}</span></code>.</li>
<li>We strongly recommend that you create these stories using interactive learning, because if you
type these by hand you will probably forget to add all of the slots.</li>
<li>Any slots that are already set won‚Äôt be asked for. E.g. if someone says ‚ÄúI‚Äôd like a Chinese restaurant for 8 people‚Äù the <code class="docutils literal notranslate"><span class="pre">submit</span></code> function should get called right away.</li>
</ul>
<div class="section" id="form-fields-and-free-text-input">
<h3>Form Fields and Free-text Input<a class="headerlink" href="#form-fields-and-free-text-input" title="Permalink to this headline">¬∂</a></h3>
<p>The pre-defined <code class="docutils literal notranslate"><span class="pre">FormField</span></code> types are:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">EntityFormField(entity_name,</span> <span class="pre">slot_name)</span></code>, which will
look for an entity called <code class="docutils literal notranslate"><span class="pre">entity_name</span></code> to fill a slot <code class="docutils literal notranslate"><span class="pre">slot_name</span></code>.</li>
<li><code class="docutils literal notranslate"><span class="pre">BooleanFormField(slot_name,</span> <span class="pre">affirm_intent,</span> <span class="pre">deny_intent)</span></code>, which looks for the intents <code class="docutils literal notranslate"><span class="pre">affirm_intent</span></code>
and <code class="docutils literal notranslate"><span class="pre">deny_intent</span></code> to fill a boolean slot called <code class="docutils literal notranslate"><span class="pre">slot_name</span></code>.</li>
<li><code class="docutils literal notranslate"><span class="pre">FreeTextFormField(slot_name)</span></code>, which will use the next user utterance to fill the text slot <code class="docutils literal notranslate"><span class="pre">slot_name</span></code>.</li>
</ul>
<p>For any subclass of  <code class="docutils literal notranslate"><span class="pre">FormField</span></code>, its <code class="docutils literal notranslate"><span class="pre">validate()</span></code> method will be called before setting it
as a slot. By default this just checks that the value isn‚Äôt <code class="docutils literal notranslate"><span class="pre">None</span></code>, but if you want to check
the value against a DB, or check a pattern is matched, you can do so by defining your own class
like <code class="docutils literal notranslate"><span class="pre">MyCustomFormField</span></code> and overriding the <code class="docutils literal notranslate"><span class="pre">validate()</span></code> method.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">The <code class="docutils literal notranslate"><span class="pre">FreeTextFormField</span></code> class will just extract the user message as a value.
However, there is currently no way to write a ‚Äòwildcard‚Äô intent in Rasa Core stories as of now.
Typically your NLU model will assign this free-text input to 2-3 different intents.
It‚Äôs easiest to add stories for each of these.</p>
</div>
</div>
</div>
</div>


          </div>
          
        </div>
      </div>
    <div class="clearer"></div>
  </div>
    <div class="footer">
      &copy;2018, Rasa Technologies GmbH | <a href="https://rasa.com/imprint/" target="_blank">Imprint</a> | <a href="https://rasa.com/privacy-policy/" target="_blank">Privacy Policy</a> 
      

    </div>

    

  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async type="opt-in" data-name="googleanalytics" data-type="text/javascript" data-src="https://www.googletagmanager.com/gtag/js?id=UA-87333416-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];

    function gtag() {
      dataLayer.push(arguments);
    }
    gtag('js', new Date());
    gtag('config', 'UA-87333416-1', {
      'anonymize_ip': true,
    });
  </script>
  </body>
</html>